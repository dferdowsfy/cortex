rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ── Per-user settings: only the owner can read/write ──────────
    match /users/{uid}/settings/{docId} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }

    // ── User profile document ────────────────────────────────────
    match /users/{uid} {
      allow read: if request.auth != null && request.auth.uid == uid;
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // ── Global proxy config (admin-only via server SDK) ──────────
    match /proxy_config/{docId} {
      allow read: if request.auth != null;
      allow write: if false; // Server-side only via Admin SDK
    }

    // ── Proxy events (server writes, authenticated reads) ────────
    match /proxy_events/{eventId} {
      allow read: if request.auth != null;
      allow write: if false; // Server-side only
    }

    // ── Alerts (server writes, authenticated reads) ──────────────
    match /proxy_alerts/{alertId} {
      allow read: if request.auth != null;
      allow write: if false; // Server-side only
    }

    // ── Agent registry (server writes, authenticated reads) ──────
    match /agent_registry/{agentId} {
      allow read: if request.auth != null;
      allow write: if false; // Server-side only
    }
  }
}
